---
title: Linux 下 C 函数
date: 2020-06-27
tags:
  - 学习，编程
categories:
  - Notes
---

## 1. Linux 文件 IO 函数

> 🚀 在 linux 下面如果想要对文件进行操作，可以通过以下的函数实现。
>
> （1）open / close：打开或关闭一个文件
>
> （2）read：从文件里读取数据
>
> （3）write：向文件写数据
>
> （4）lseek：对文件光标进行重定位

### 1.1 open

> 📌 用来打开一个文件

```c
int open(const char *pathname, int flags);
```

- include：
  - `#include <sys/types.h>`
  - `#include <sys/stat.h>`
  - `#include <fcntl.h>`
- pathname：要打开或创建的文件名（带路径名）
- flags：打开标志。告诉系统，是以何种方式打开这个文件
  - `O_RDONLY`：read only
  - `O_WRONLY`：write only
  - `O_RDWR`：read / write
- return：返回值类型为`int`
  - 如果成功返回文件描述符（＞ 0，后续所有对文件的操作都必须通过它，因为它代表这个文件。）
  - 失败返回－1，并且 errno 被设置

### 1.2 close

> 📌 用来关闭一个文件描述符

```c
int close(int fd);
```

- 头 include：
  - `#include <unistd.h>`
- fd：要关闭的那个文件的文件描述符
- return：返回值类型为`int`
  - 成功返回 0
  - 失败返回－1

### 1.3 read

> 📌 用来从 fd 指定的文件中读取 nbyte 哥字节数剧到 buff 指向的空间中去。同时文件光标往后移

```c
ssize_t read(int fd, void *buf, size_t nbyte);
```

- include：
  - `#include <unistd.h>`
- fd：从文件描述符（open 返回值），表示从哪个文件里面读
- buf：一个指针，指向一段内存，用来保存从文件里面读到的数据
- nbyte：读多少字节数据
- return：返回值类型为 ssize_t
  - ＞ 0：成功读取到的字节数，文件偏移量（光标）随之增加
  - ＝ 0：到达文件尾（文件结束）
  - －1：出错，同时 errno 被设置

### 1.4 write

> 📌 用来把 buf 指向的内存空间中至多 nbyte 个字节数据写到 fd 指定的文件中去。同时文件光标往后移

```c
ssize_t write(int fd, const void *buf, size_t nbyte);
```

- include：
  - `#include <unistd.h>`
- fd：文件描述符（open 返回值），表示写到哪个文件中去
- buf：指针，指向要写到文件中去的数据
- nbyte：写多少字节
- return：
  - ＞ 0：成功写到文件中去的字节数，文件偏移量随之增加
  - ＝ 0：什么也没有写
  - －1：出错，同时 errno 被设置

### 1.5 lseek

> 📌 用来给指定文件定位光标（设置偏移量）

```c
off_t lseek(int fd, off_t offset, int wheence);
```

- include：
  - `#include <sys/types.h>`
  - `#include <unistd.h>`
- fd：文件描述符，要定位的文件
- offset：要设置的偏移量
- whence：定位方式，有三种
  - `SEEK_SET`：基于文件开头定位
    - 新的光标位置为＝文件开头＋ offset（不能＜ 0）
  - `SEEK_CUR`：基于当前光标位置定位
    - 新的光标位置为＝当前位置＋ offset（可正可负）
  - `SEEK_END`：基于文件末尾定位
    - 新的光标位置为＝文件末尾＋ offset（可正可负）
- return：
  - 成功返回新的光标位置相对于文件开头的偏移量（以字节为单位）
  - 失败返回－1
